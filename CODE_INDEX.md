# Code Index

*Auto-generated by /update-code-index*
*Last updated: 2026-02-11*

> Before writing new code, search this index first!
> Find similar functionality? Use or extend it instead of creating new.

## Quick Stats

| Category | Count | Main Location |
|----------|-------|---------------|
| API Connectors | 6 classes | `app/services/` |
| API Routes | 22 endpoints | `app/api/routes/` |
| DB Models | 11 classes | `app/models/models.py` |
| Pydantic Schemas | 25 classes | `app/api/schemas.py` |
| Enums | 12 enums | `app/models/enums.py` |
| Schedulers | 2 classes | `app/schedulers/` |
| React Components | 48 components | `frontend/src/` |
| Frontend Services | 7 modules (25+ functions) | `frontend/src/services/` |
| UI Components | 5 reusable | `frontend/src/components/ui/` |

---

## API Connectors (`app/services/`)

Base class + 5 concrete connectors for external service integration.

| Class | Location | Description |
|-------|----------|-------------|
| `BaseConnector` | base_connector.py:6 | Classe de base — async HTTP client (httpx) with GET/POST/PUT/DELETE |
| `RadarrConnector` | radarr_connector.py:7 | Connecteur Radarr — movies, calendar, history, statistics |
| `SonarrConnector` | sonarr_connector.py:7 | Connecteur Sonarr — series, calendar, history, statistics |
| `JellyfinConnector` | jellyfin_connector.py:7 | Connecteur Jellyfin — users, library, playback stats, watch time |
| `JellyseerrConnector` | jellyseerr_connector.py:6 | Connecteur Jellyseerr — requests, approve/decline, statistics |
| `QBittorrentConnector` | qbittorrent_connector.py:15 | Connecteur qBittorrent — session auth (aiohttp), torrent info |

### BaseConnector Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `_get()` | `(endpoint, params?)` | Requete GET |
| `_post()` | `(endpoint, data?, json?)` | Requete POST |
| `_put()` | `(endpoint, data?)` | Requete PUT |
| `_delete()` | `(endpoint)` | Requete DELETE |
| `_get_headers()` | `()` | Headers par defaut (surcharge dans filles) |
| `test_connection()` | `()` | Tester la connexion API |
| `close()` | `()` | Fermer la connexion HTTP |

### RadarrConnector Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `get_movies()` | `()` | Recuperer tous les films |
| `get_calendar()` | `(days_ahead=30)` | Calendrier des sorties |
| `get_recent_additions()` | `(days=7)` | Films recemment ajoutes |
| `get_history()` | `(page_size=50)` | Historique des telechargements |
| `get_movie_history_map()` | `()` | Map {movieId: torrent_hash} |
| `get_statistics()` | `()` | Statistiques Radarr |

### SonarrConnector Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `get_series()` | `()` | Recuperer toutes les series |
| `get_calendar()` | `(days_ahead=30)` | Calendrier des episodes |
| `get_recent_additions()` | `(days=7)` | Series recemment ajoutees |
| `get_history()` | `(page_size=50)` | Historique des telechargements |
| `get_series_history_map()` | `()` | Map {seriesId: torrent_hash} |
| `get_statistics()` | `()` | Statistiques Sonarr |

### JellyfinConnector Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `get_users()` | `()` | Recuperer tous les utilisateurs |
| `get_library_items()` | `()` | Nombre d'items par type |
| `get_recent_items()` | `(limit=20)` | Items recemment ajoutes |
| `get_playback_stats()` | `(days=30)` | Statistiques de lecture |
| `get_total_watch_time()` | `(days=30)` | Temps de visionnage total (Playback Reporting plugin) |
| `get_movies_details()` | `()` | Details complets des films (nombre, duree) |
| `get_tv_shows_details()` | `()` | Details complets des series TV |

### JellyseerrConnector Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `get_requests()` | `(limit=100, status="all")` | Demandes de medias avec pagination |
| `get_media_details()` | `(tmdb_id, media_type)` | Details d'un media via tmdbId |
| `approve_request()` | `(request_id)` | Approuver une demande |
| `decline_request()` | `(request_id)` | Refuser une demande |
| `get_statistics()` | `()` | Statistiques des demandes |

### QBittorrentConnector Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `login()` | `()` | Authentification cookie-based |
| `get_torrent_info()` | `(torrent_hash)` | Info d'un torrent par hash |
| `test_connection()` | `()` | Tester la connexion |

---

## Connector Factory

| Function | Location | Description |
|----------|----------|-------------|
| `create_connector()` | connector_factory.py:13 | Cree le bon connector selon ServiceType |

---

## API Routes (`app/api/routes/`)

### Dashboard (`dashboard.py`)

| Endpoint | Function | Description |
|----------|----------|-------------|
| `GET /api/dashboard` | `get_dashboard()` | Toutes les donnees du dashboard |
| `GET /api/dashboard/statistics` | `get_statistics()` | Statistiques uniquement |
| `GET /api/dashboard/recent-items` | `get_recent_items()` | Items recemment ajoutes (sortable) |
| `GET /api/dashboard/calendar` | `get_calendar()` | Calendrier des sorties |
| `GET /api/dashboard/requests` | `get_requests()` | Requetes Jellyseerr |

### Services (`services.py`)

| Endpoint | Function | Description |
|----------|----------|-------------|
| `GET /api/services` | `get_all_services()` | Toutes les configurations |
| `GET /api/services/{name}` | `get_service()` | Configuration specifique |
| `POST /api/services` | `create_service()` | Creer une configuration |
| `PUT /api/services/{name}` | `update_service()` | Modifier une configuration |
| `DELETE /api/services/{name}` | `delete_service()` | Supprimer une configuration |
| `POST /api/services/{name}/test` | `test_service_connection()` | Tester la connexion |

### Sync (`sync.py`)

| Endpoint | Function | Description |
|----------|----------|-------------|
| `POST /api/sync` | `trigger_sync()` | Synchronisation manuelle complete |
| `POST /api/sync/{name}` | `trigger_service_sync()` | Sync d'un service specifique |
| `GET /api/sync/status` | `get_sync_status()` | Statut des dernieres syncs |

### Torrents (`torrents.py`)

| Endpoint | Function | Description |
|----------|----------|-------------|
| `GET /api/torrents/{hash}` | `get_torrent_info()` | Info d'un torrent |
| `POST /api/torrents/enrich` | `enrich_library_items()` | Enrichir items avec data qBT |
| `POST /api/torrents/enrich/recent` | `enrich_recent_items()` | Enrichir items recents |

### Analytics (`analytics.py`) — Webhook public, queries auth

| Endpoint | Function | Description |
|----------|----------|-------------|
| `POST /api/analytics/webhook` | `receive_playback_webhook()` | Webhook Jellyfin (public, no auth) |
| `GET /api/analytics/usage` | `get_usage_analytics()` | Vue 1: Graphique temporel |
| `GET /api/analytics/media` | `get_media_playback_analytics()` | Vue 2: Tableau media detaille |
| `GET /api/analytics/sessions` | `get_active_sessions()` | Vue 3: Sessions actives temps reel |
| `GET /api/analytics/devices` | `get_device_breakdown()` | Vue 3: Repartition par appareil |
| `GET /api/analytics/server` | `get_server_metrics()` | Vue 3: Metriques serveur |

### Jellyseerr (`jellyseerr.py`)

| Endpoint | Function | Description |
|----------|----------|-------------|
| `POST /api/jellyseerr/{id}/approve` | `approve_request()` | Approuver une requete |
| `POST /api/jellyseerr/{id}/decline` | `decline_request()` | Refuser une requete |

---

## Database Models (`app/models/models.py`)

| Model | Line | Description |
|-------|------|-------------|
| `ServiceConfiguration` | 29 | Configuration des services externes (URL, API key, port) |
| `DashboardStatistic` | 48 | Statistiques du dashboard (counts, details JSON) |
| `SyncMetadata` | 61 | Metadata de synchronisation (status, duree, records) |
| `LibraryItem` | 77 | Items de bibliotheque (films, series, episodes) |
| `CalendarEvent` | 99 | Evenements calendrier (sorties a venir) |
| `JellyseerrRequest` | 115 | Requetes media Jellyseerr |
| `PlaybackSession` | 138 | Sessions de lecture des medias |
| `MediaStatistic` | 200 | Statistiques agregees par media |
| `DeviceStatistic` | 237 | Statistiques agregees par type d'appareil |
| `DailyAnalytic` | 265 | Statistiques agregees par jour |
| `ServerMetric` | 295 | Metriques serveur (CPU, RAM, disque, reseau) |

---

## Enums (`app/models/enums.py`)

| Enum | Line | Values |
|------|------|--------|
| `ServiceType` | 4 | radarr, sonarr, jellyfin, jellyseerr, qbittorrent |
| `StatType` | 12 | total_movies, total_series, etc. |
| `SyncStatus` | 19 | pending, running, success, error |
| `MediaType` | 26 | movie, series, episode, season |
| `RequestPriority` | 31 | low, normal, high, urgent |
| `CalendarStatus` | 37 | upcoming, released, downloaded |
| `DeviceType` | 43 | tv, mobile, desktop, tablet, other |
| `PlaybackMethod` | 53 | direct_play, transcode, direct_stream |
| `VideoQuality` | 59 | sd, hd_720, hd_1080, uhd_4k |
| `SessionStatus` | 69 | active, paused, stopped |
| `RequestStatus` | 76 | pending, approved, processing, declined, available |
| `ItemSortBy` | 82 | added_date, year, title |

---

## Pydantic Schemas (`app/api/schemas.py`)

| Schema | Line | Purpose |
|--------|------|---------|
| `ServiceConfigurationBase` | 25 | Base schema with URL/key validation |
| `ServiceConfigurationCreate` | 42 | Creation with credential validation per type |
| `ServiceConfigurationUpdate` | 65 | Partial update schema |
| `ServiceConfigurationResponse` | 74 | Response with masked api_key |
| `DashboardStatisticResponse` | 95 | Dashboard stat response |
| `LibraryItemResponse` | 109 | Library item response |
| `CalendarEventResponse` | 130 | Calendar event response |
| `JellyseerrRequestResponse` | 146 | Jellyseerr request response |
| `JellyseerrRequestAction` | 168 | Approve/decline action |
| `SyncMetadataResponse` | 174 | Sync metadata response |
| `DashboardResponse` | 191 | Full dashboard response |
| `PlaybackSessionResponse` | 199 | Playback session response |
| `WebhookPlaybackData` | 233 | Jellyfin webhook data |
| `WebhookPayload` | 257 | Webhook payload |
| `MediaStatisticResponse` | 265 | Media statistic response |
| `DeviceStatisticResponse` | 291 | Device statistic response |
| `DailyAnalyticResponse` | 309 | Daily analytics response |
| `ServerMetricResponse` | 330 | Server metrics response |
| `UsageAnalyticsResponse` | 354 | Usage analytics (Vue 1) |
| `MediaPlaybackAnalyticsItem` | 362 | Media playback item (Vue 2) |
| `ActiveSessionItem` | 375 | Active session (Vue 3) |
| `DeviceBreakdownItem` | 387 | Device breakdown (Vue 3) |
| `ServerPerformanceResponse` | 395 | Server performance (Vue 3) |

---

## Service Layer

### AnalyticsService (`app/services/analytics_service.py`)

| Method | Signature | Description |
|--------|-----------|-------------|
| `map_device_type()` | `(client_name, device_name)` | Determine type d'appareil |
| `map_video_quality()` | `(quality_str)` | Convertit qualite en VideoQuality |
| `map_playback_method()` | `(is_transcoding, is_direct_playing)` | Methode de lecture |
| `start_session()` | `(db, session_data)` | Demarre session de lecture |
| `stop_session()` | `(db, media_id, user_id, watched_seconds?)` | Arrete session |
| `pause_session()` | `(db, media_id, user_id)` | Met en pause |
| `resume_session()` | `(db, media_id, user_id)` | Reprend session |
| `update_media_statistics()` | `(db, session)` | MAJ stats media apres session |
| `update_daily_analytics()` | `(db, session)` | MAJ analytics quotidiennes |
| `get_active_sessions()` | `(db)` | Sessions actives |
| `cleanup_orphan_sessions()` | `(db, timeout_hours=24)` | Nettoie sessions orphelines |
| `update_device_statistics()` | `(db, target_date?)` | MAJ stats par appareil |

### TorrentEnrichmentService (`app/services/torrent_enrichment_service.py`)

| Method | Signature | Description |
|--------|-----------|-------------|
| `enrich_item()` | `(item)` | Enrichit un item avec data qBittorrent |
| `enrich_all_items()` | `(limit?)` | Enrichit tous les items avec torrent_hash |
| `enrich_recent_items()` | `(days=7)` | Enrichit items recents |

### MetricsService (`app/services/metrics_service.py`)

| Method | Signature | Description |
|--------|-----------|-------------|
| `get_cpu_usage()` | `()` | Utilisation CPU % |
| `get_memory_usage()` | `()` | Utilisation memoire |
| `get_disk_usage()` | `()` | Utilisation disque |
| `get_network_bandwidth()` | `()` | Bande passante reseau Mbps |
| `determine_status()` | `(value, warning_threshold, error_threshold)` | Statut basé sur seuils |
| `capture_metrics()` | `(db)` | Capture et enregistre toutes les metriques |
| `cleanup_old_metrics()` | `(db, keep_days=7)` | Nettoie anciennes metriques |

---

## Schedulers

### AppScheduler (`app/schedulers/scheduler.py`)

| Method | Signature | Description |
|--------|-----------|-------------|
| `run_sync_job()` | `()` | Tache de sync (toutes les 15 min) |
| `start()` | `(interval_minutes=15)` | Demarrer le scheduler |
| `stop()` | `()` | Arreter le scheduler |

### SyncService (`app/schedulers/sync_service.py`)

| Method | Signature | Description |
|--------|-----------|-------------|
| `sync_radarr()` | `()` | Sync donnees Radarr |
| `sync_sonarr()` | `()` | Sync donnees Sonarr |
| `sync_jellyfin()` | `()` | Sync donnees Jellyfin |
| `sync_jellyseerr()` | `()` | Sync donnees Jellyseerr (upsert) |
| `sync_monitored_items()` | `()` | Sync items monitores (Radarr + Sonarr) |
| `sync_all()` | `()` | Sync tous les services |

### AnalyticsScheduler (`app/schedulers/analytics_scheduler.py`)

| Method | Signature | Description |
|--------|-----------|-------------|
| `start()` | `()` | Demarre schedulers analytics |
| `stop()` | `()` | Arrete schedulers |

---

## Database / Config Utilities

| Function | Location | Description |
|----------|----------|-------------|
| `get_db()` | db.py:36 | Dependance FastAPI pour session DB |
| `check_db_connection()` | db.py:45 | Verifier connexion DB |
| `init_db()` | db.py:55 | Initialiser DB (creer tables) |
| `generate_uuid()` | models.py:23 | Genere UUID string |
| `verify_api_key()` | security.py:10 | Verifie X-API-Key header |
| `Settings` | config.py:4 | Configuration pydantic-settings (.env) |
| `_truncate()` | analytics.py:39 | Tronque string a longueur max |

---

## React Components — Pages

| Component | Location | Description |
|-----------|----------|-------------|
| `MainDashboard` | pages/main-dashboard/index.jsx:15 | Page dashboard principal |
| `Library` | pages/library/index.jsx:51 | Page bibliotheque |
| `Calendar` | pages/calendar/index.jsx:9 | Page calendrier |
| `MediaDetail` | pages/media-detail/index.jsx:11 | Page detail media |
| `Monitoring` | pages/monitoring/index.jsx:8 | Page monitoring |
| `JellyfinStatistics` | pages/jellyfin-statistics/index.jsx:12 | Page analytics/statistiques |
| `JellyseerrRequests` | pages/jellyseerr-requests/index.jsx:10 | Page requetes Jellyseerr |
| `Alerts` | pages/alerts/index.jsx:11 | Page gestion des alertes |
| `InitialConfiguration` | pages/initial-configuration/index.jsx:13 | Page config initiale services |
| `NotFound` | pages/NotFound.jsx:6 | Page 404 |

## React Components — Dashboard Widgets

| Component | Location | Description |
|-----------|----------|-------------|
| `StatisticsCard` | main-dashboard/components/StatisticsCard.jsx:4 | Carte statistique avec trend |
| `RecentAdditionsCard` | main-dashboard/components/RecentAdditionsCard.jsx:6 | Carte ajout recent |
| `CalendarEvent` | main-dashboard/components/CalendarEvent.jsx:5 | Carte evenement calendrier |
| `MiniCalendar` | main-dashboard/components/MiniCalendar.jsx:6 | Widget mini-calendrier |
| `RequestCard` | main-dashboard/components/RequestCard.jsx:6 | Carte requete media (approve/reject) |

## React Components — Library

| Component | Location | Description |
|-----------|----------|-------------|
| `MediaGrid` | library/components/MediaGrid.jsx:5 | Grille responsive de medias |
| `MediaCard` | library/components/MediaCard.jsx:6 | Carte media individuelle |
| `FilterToolbar` | library/components/FilterToolbar.jsx:7 | Barre de filtres bibliotheque |

## React Components — Calendar

| Component | Location | Description |
|-----------|----------|-------------|
| `CalendarGrid` | calendar/components/CalendarGrid.jsx:4 | Grille du calendrier |
| `EventSidebar` | calendar/components/EventSidebar.jsx:5 | Sidebar evenements |
| `ViewToolbar` | calendar/components/ViewToolbar.jsx:6 | Barre d'outils calendrier |

## React Components — Media Detail

| Component | Location | Description |
|-----------|----------|-------------|
| `HeroBanner` | media-detail/components/HeroBanner.jsx:6 | Banniere hero avec backdrop |
| `MetadataPanel` | media-detail/components/MetadataPanel.jsx:4 | Panel metadata |
| `FileInfoPanel` | media-detail/components/FileInfoPanel.jsx:5 | Panel info fichiers |
| `EpisodesList` | media-detail/components/EpisodesList.jsx:6 | Liste saisons/episodes |

## React Components — Monitoring

| Component | Location | Description |
|-----------|----------|-------------|
| `MonitoringTable` | monitoring/components/MonitoringTable.jsx:8 | Table de monitoring |
| `StatusIndicator` | monitoring/components/StatusIndicator.jsx:4 | Badge indicateur de statut |
| `ExpandableRow` | monitoring/components/ExpandableRow.jsx:5 | Ligne expandable monitoring |
| `FilterToolbar` | monitoring/components/FilterToolbar.jsx:6 | Filtres monitoring |

## React Components — Analytics

| Component | Location | Description |
|-----------|----------|-------------|
| `UsageChart` | jellyfin-statistics/components/UsageChart.jsx:5 | Graphique analytics |
| `UserStatsCard` | jellyfin-statistics/components/UserStatsCard.jsx:4 | Carte stats utilisateurs |
| `DeviceBreakdownCard` | jellyfin-statistics/components/DeviceBreakdownCard.jsx:5 | Pie chart appareils |
| `ServerPerformancePanel` | jellyfin-statistics/components/ServerPerformancePanel.jsx:4 | Panel performance serveur |
| `MetricCard` | jellyfin-statistics/components/ServerPerformancePanel.jsx:5 | Carte metrique individuelle |
| `MediaAnalyticsTable` | jellyfin-statistics/components/MediaAnalyticsTable.jsx:5 | Table analytics media |
| `FilterToolbar` | jellyfin-statistics/components/FilterToolbar.jsx:6 | Filtres analytics |

## React Components — Requests

| Component | Location | Description |
|-----------|----------|-------------|
| `FilterToolbar` | jellyseerr-requests/components/FilterToolbar.jsx:6 | Filtres requetes |

## React Components — Alerts

| Component | Location | Description |
|-----------|----------|-------------|
| `AlertCard` | alerts/components/AlertCard.jsx:7 | Carte alerte |
| `AlertHistory` | alerts/components/AlertHistory.jsx:7 | Historique alertes |
| `FilterToolbar` | alerts/components/FilterToolbar.jsx:5 | Filtres alertes |

## React Components — Configuration

| Component | Location | Description |
|-----------|----------|-------------|
| `ServiceCard` | initial-configuration/components/ServiceCard.jsx:6 | Carte config service |
| `ConfigurationProgress` | initial-configuration/components/ConfigurationProgress.jsx:4 | Barre de progression config |
| `SecurityInfo` | initial-configuration/components/SecurityInfo.jsx:4 | Panel securite/confidentialite |
| `QuickStartGuide` | initial-configuration/components/QuickStartGuide.jsx:5 | Guide demarrage rapide |

## React Components — Shared UI

| Component | Location | Description |
|-----------|----------|-------------|
| `Button` | components/ui/Button.jsx:38 | Bouton avec variants, sizes, icons, loading |
| `Input` | components/ui/Input.jsx:4 | Champ input avec label, erreur, description |
| `Select` | components/ui/Select.jsx:8 | Dropdown avec recherche, multi-select |
| `Checkbox` | components/ui/Checkbox.jsx:5 | Checkbox avec etat indeterminate |
| `CheckboxGroup` | components/ui/Checkbox.jsx:96 | Groupe de checkboxes |
| `Icon` | components/AppIcon.jsx:5 | Wrapper Lucide icons |
| `Image` | components/AppImage.jsx:3 | Image avec fallback |
| `ErrorBoundary` | components/ErrorBoundary.jsx:4 | Error boundary React |
| `ScrollToTop` | components/ScrollToTop.jsx:4 | Auto-scroll on navigation |
| `Header` | components/navigation/Header.jsx:6 | Navigation header principal |

---

## Frontend Services (`frontend/src/services/`)

### configService.js

| Function | Signature | Description |
|----------|-----------|-------------|
| `getServiceConfigurations()` | `()` | Fetch all service configs |
| `getServiceConfiguration()` | `(serviceName)` | Fetch single config |
| `saveServiceConfiguration()` | `(serviceName, config)` | Save/update config |
| `testServiceConnection()` | `(serviceName)` | Test connection |
| `deleteServiceConfiguration()` | `(serviceName)` | Delete config |

### dashboardService.js

| Function | Signature | Description |
|----------|-----------|-------------|
| `getDashboardStatistics()` | `()` | Fetch dashboard stats |
| `getRecentItems()` | `(limit)` | Get recent additions |

### libraryService.js

| Function | Signature | Description |
|----------|-----------|-------------|
| `getRecentItems()` | `(limit, sortBy, sortOrder)` | Get recent library items |
| `getLibraryItems()` | `()` | Fetch all library items |
| `getMediaDetail()` | `(id)` | Get detailed media info |

### calendarService.js

| Function | Signature | Description |
|----------|-----------|-------------|
| `getCalendarEvents()` | `(days)` | Fetch calendar events |

### analyticsService.js

| Function | Signature | Description |
|----------|-----------|-------------|
| `getUsageAnalytics()` | `(startDate, endDate)` | Fetch usage analytics |
| `getDeviceBreakdown()` | `(periodDays)` | Get device breakdown |
| `getMediaAnalytics()` | `(limit, sortBy, order)` | Fetch media analytics |
| `getServerMetrics()` | `()` | Fetch server metrics |

### requestService.js

| Function | Signature | Description |
|----------|-----------|-------------|
| `getJellyseerrRequests()` | `(status, limit)` | Fetch media requests |

### syncService.js

| Function | Signature | Description |
|----------|-----------|-------------|
| `getAllSyncMetadata()` | `()` | Fetch all sync metadata |
| `triggerSync()` | `()` | Trigger manual sync |

---

## Frontend Utilities

| Function | Location | Description |
|----------|----------|-------------|
| `cn()` | utils/cn.js:4 | Tailwind class merger (clsx + tailwind-merge) |
| `formatFileSize()` | pages/library/index.jsx:17 | Format file size to GB |
| `useAuth()` | contexts/AuthContext.jsx:5 | Auth context hook |
| `AuthProvider` | contexts/AuthContext.jsx:13 | Auth context provider |
| `servarrHubClient` | lib/servarrHubClient.js:14 | Axios HTTP client instance |

---

## Possible Duplicates / Review

| Item | Locations | Notes |
|------|-----------|-------|
| `FilterToolbar` | 5 different pages | Same name, different props per page — intentional per-page variants |
| `getRecentItems()` | dashboardService.js + libraryService.js | Different params — dashboard version simpler |
| `_extract_hash()` | radarr_connector.py + sonarr_connector.py | Identical logic — candidate for extraction to BaseConnector |
